#include <math.h>

#define SENS_PIN 0

// ADC , Temp , Coef i - 1
float tab[110][3] = {
{ 1.00 , -83.64 , 18.94 },
{ 10.00 , -55.70 , 2.79 },
{ 20.00 , -45.91 , 0.98 },
{ 30.00 , -39.79 , 0.61 },
{ 40.00 , -35.23 , 0.46 },
{ 50.00 , -31.55 , 0.37 },
{ 60.00 , -28.45 , 0.31 },
{ 70.00 , -25.75 , 0.27 },
{ 80.00 , -23.34 , 0.24 },
{ 90.00 , -21.16 , 0.22 },
{ 100.00 , -19.16 , 0.20 },
{ 110.00 , -17.31 , 0.19 },
{ 120.00 , -15.58 , 0.17 },
{ 130.00 , -13.96 , 0.16 },
{ 140.00 , -12.42 , 0.15 },
{ 150.00 , -10.96 , 0.15 },
{ 160.00 , -9.56 , 0.14 },
{ 170.00 , -8.22 , 0.13 },
{ 180.00 , -6.94 , 0.13 },
{ 190.00 , -5.69 , 0.12 },
{ 200.00 , -4.49 , 0.12 },
{ 210.00 , -3.33 , 0.12 },
{ 220.00 , -2.19 , 0.11 },
{ 230.00 , -1.09 , 0.11 },
{ 240.00 , -0.01 , 0.11 },
{ 250.00 , 1.04 , 0.11 },
{ 260.00 , 2.08 , 0.10 },
{ 270.00 , 3.09 , 0.10 },
{ 280.00 , 4.09 , 0.10 },
{ 290.00 , 5.07 , 0.10 },
{ 300.00 , 6.03 , 0.10 },
{ 310.00 , 6.99 , 0.10 },
{ 320.00 , 7.93 , 0.09 },
{ 330.00 , 8.86 , 0.09 },
{ 340.00 , 9.78 , 0.09 },
{ 350.00 , 10.69 , 0.09 },
{ 360.00 , 11.59 , 0.09 },
{ 370.00 , 12.49 , 0.09 },
{ 380.00 , 13.38 , 0.09 },
{ 390.00 , 14.27 , 0.09 },
{ 400.00 , 15.16 , 0.09 },
{ 410.00 , 16.04 , 0.09 },
{ 420.00 , 16.91 , 0.09 },
{ 430.00 , 17.79 , 0.09 },
{ 440.00 , 18.67 , 0.09 },
{ 450.00 , 19.54 , 0.09 },
{ 460.00 , 20.42 , 0.09 },
{ 470.00 , 21.29 , 0.09 },
{ 480.00 , 22.17 , 0.09 },
{ 490.00 , 23.05 , 0.09 },
{ 500.00 , 23.93 , 0.09 },
{ 510.00 , 24.82 , 0.09 },
{ 520.00 , 25.71 , 0.09 },
{ 530.00 , 26.61 , 0.09 },
{ 540.00 , 27.51 , 0.09 },
{ 550.00 , 28.42 , 0.09 },
{ 560.00 , 29.34 , 0.09 },
{ 570.00 , 30.27 , 0.09 },
{ 580.00 , 31.20 , 0.09 },
{ 590.00 , 32.15 , 0.09 },
{ 600.00 , 33.10 , 0.10 },
{ 610.00 , 34.07 , 0.10 },
{ 620.00 , 35.05 , 0.10 },
{ 630.00 , 36.05 , 0.10 },
{ 640.00 , 37.06 , 0.10 },
{ 650.00 , 38.08 , 0.10 },
{ 660.00 , 39.13 , 0.10 },
{ 670.00 , 40.19 , 0.11 },
{ 680.00 , 41.28 , 0.11 },
{ 690.00 , 42.39 , 0.11 },
{ 700.00 , 43.52 , 0.11 },
{ 710.00 , 44.68 , 0.12 },
{ 720.00 , 45.86 , 0.12 },
{ 730.00 , 47.08 , 0.12 },
{ 740.00 , 48.33 , 0.13 },
{ 750.00 , 49.62 , 0.13 },
{ 760.00 , 50.95 , 0.13 },
{ 770.00 , 52.32 , 0.14 },
{ 780.00 , 53.74 , 0.14 },
{ 790.00 , 55.21 , 0.15 },
{ 800.00 , 56.74 , 0.15 },
{ 810.00 , 58.33 , 0.16 },
{ 820.00 , 59.99 , 0.17 },
{ 830.00 , 61.73 , 0.17 },
{ 840.00 , 63.56 , 0.18 },
{ 850.00 , 65.49 , 0.19 },
{ 860.00 , 67.53 , 0.20 },
{ 870.00 , 69.69 , 0.22 },
{ 880.00 , 72.00 , 0.23 },
{ 890.00 , 74.49 , 0.25 },
{ 900.00 , 77.17 , 0.27 },
{ 910.00 , 80.08 , 0.29 },
{ 920.00 , 83.28 , 0.32 },
{ 930.00 , 86.83 , 0.35 },
{ 940.00 , 90.80 , 0.40 },
{ 950.00 , 95.34 , 0.45 },
{ 960.00 , 100.60 , 0.53 },
{ 970.00 , 106.87 , 0.63 },
{ 980.00 , 114.61 , 0.77 },
{ 990.00 , 124.68 , 1.01 },
{ 1000.00 , 138.93 , 1.42 },
{ 1010.00 , 162.71 , 2.38 },
{ 1020.00 , 228.73 , 6.60 },
};

// Hard way to calculate the Temp
float Calcul_Temp(int RawADC)
{
 double Temp;
 Temp = log(10000.0*((1024.0/RawADC-1))); 
 Temp = 1 / (0.001129148 + (0.000234125 + (0.0000000876741 * Temp * Temp ))* Temp );
 Temp = Temp - 273.15;
 return (Temp);
}

// Display the tab like in Excel
void Create_Tab()
{
 int i = 1;
 float tmp;
 float tmp2 = -273.0;
 while (i < 1024)
  {
    Serial.print("{ ");
    Serial.print(float(i));
    Serial.print(" , ");
    tmp = float(Calcul_Temp(i));
    Serial.print(tmp);
    Serial.print(" , ");
    Serial.print((tmp - tmp2) / 10);
    Serial.println(" },");
    tmp2 = tmp;
    if (i == 1)
      i = 0;
    i = i + 10;
  }
  delay(10000000);
}

// Esay way to calculate the temp with the tab
float Calcul_Temp_Tab(int RawADC)
{
 int i = 0;
 float res = 0.0;
 float coef = 0.0;
 
 while(tab[i][0] < RawADC && i < 990)
 {
  i++;
 }
   res = float(tab[i - 1][1]) + tab[i][2] * float(RawADC % 10);
   return (res);
}

// Function for unit_testing
void Unit_Test()
{
  int adc;
  adc = 1;
  while( adc<990) {
    float temp = Calcul_Temp_Tab(adc);
    Serial.print(adc);
    Serial.print(" , ");
    Serial.println(temp);
    adc = adc + 1;
  }
  delay(10000000);
}

void setup() {
 Serial.begin(57600);
 Unit_Test();
 //Create_Tab();
}

void loop()
{
 int RawADC = analogRead(SENS_PIN);
 Serial.print(RawADC);
 Serial.print(" ");
 Serial.println(Calcul_Temp_Tab(RawADC));
 delay(1000);
}
